(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-live-info-android"],{"2db6":function(t,e,i){var a=i("c887");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("4f06").default;n("75038628",a,!0,{sourceMap:!1,shadowMode:!1})},"4dbc":function(t,e,i){"use strict";i.r(e);var a=i("9276"),n=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=n.a},9276:function(t,e,i){"use strict";(function(t){var a=i("4ea4");i("a15b"),i("4e82"),i("b64b"),i("d3b7"),i("ac1f"),i("25f0"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("96cf");var n=a(i("1da1")),o=a(i("7127")),s=a(i("ba4f")),r=a(i("0608")),u=getApp(),d=(0,o.default)(u.globalData.socket_url,{query:{},transports:["websocket","polling"],timeout:5e3}),l={data:function(){return{scrollH:600,tabIndex:0,tabBars:[{name:"讲师区"},{name:"讨论区"},{name:"问答区"}],list:[],isConnectSocket:!1,liveInfo:{liveuid:"",courseid:""},userInfo:{},isQue:!1,agoraappid:"",agoramRoomName:"",agorauid:"",phonetype:0,wechatliveurl:"",myID:"",animationData:{},scrollHeight:0,scrollInto:""}},onUnload:function(){AgoreRTCH5.client().leave()},onLoad:function(e){var i=this;this.myID=u.globalData.userinfo.id,t("log","myID:"+this.myID," at pages/live-info/android.nvue:195"),t("log","运行在H5"," at pages/live-info/android.nvue:201"),this.phonetype=3,this.userInfo=u.globalData.userinfo,this.liveInfo.liveuid=e.liveuid,this.liveInfo.courseid=e.courseid,this.enterLive(e.liveuid,e.courseid),d.emit("conn",{uid:this.userInfo.id,roomnum:this.liveInfo.liveuid,nickname:this.userInfo.user_nickname,stream:this.liveInfo.liveuid+"_"+this.liveInfo.courseid+"_0",equipment:"uni-app",token:this.userInfo.token,avatar:this.userInfo.avatar,sign:0,usertype:this.userInfo.type}),d.on("conn",(function(e){t("log","ws 已连接 "+e," at pages/live-info/android.nvue:231"),i.isConnectSocket=!0}));d.on("broadcastingListen",(function(e){var a=JSON.parse(e).msg[0];void 0!=a.content&&i.list.push(a),t("log",a," at pages/live-info/android.nvue:241"),i.prizeScroll()}))},methods:{changeXXK:function(t){var e=this;return(0,n.default)(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return e.tabIndex=t,i.abrupt("return",e.tabIndex);case 2:case"end":return i.stop()}}),i)})))()},onChangeTab:function(e){t("log","切换当前索引"+e.detail.current," at pages/live-info/android.nvue:259"),this.tabIndex=e.detail.current},decypt:function(t){for(var e="",i="1ecxXyLRB.COdrAi:q09Z62ash-QGn8VFNIlb=fM/D74WjS_EUzYuw?HmTPvkJ3otK5gp",a=0;a<t.length;a++)for(var n=t[a],o=0;o<i.length;o++){var s=i[o];n==s&&(e+=0==o?i[o]:i[o-1])}return e},agoraWechat:function(e,i,a){var n=this;setTimeout((function(){var o=AogoraWechat.Client();o.setRole("audience"),o.init(n.decypt(e),(function(){t("log","小程序初始化成功"," at pages/live-info/android.nvue:287"),o.join("",i,a,(function(){t("log","加入通道成功"," at pages/live-info/android.nvue:290")}),(function(e){t("log","加入通道失败"," at pages/live-info/android.nvue:292")}))}),(function(e){t("log","小程序初始化失败"," at pages/live-info/android.nvue:296")})),o.on("stream-added",(function(e){o.subscribe(evt.uid,(function(e){t("log","订阅视频流成功playUrl"+e," at pages/live-info/android.nvue:302"),n.wechatliveurl=e}),(function(e){t("log","订阅视频流错误",e," at pages/live-info/android.nvue:305"),uni.showToast({icon:"none",title:"订阅视频流错误"})}))})),o.on("stream-removed",(function(e){t("log","远端流移除"," at pages/live-info/android.nvue:314")})),o.rejoin("",i,a,"",(function(){t("log","重连加入通道成功"," at pages/live-info/android.nvue:318")}),(function(e){t("log","重连加入通道失败"," at pages/live-info/android.nvue:320")}))}),0)},agoraH5:function(e,i){var a=this;setTimeout((function(){var n=r.default.createClient({mode:"live",codec:"vp8"});r.default.client=n,n.init(a.decypt(e)),n.setClientRole("audience"),n.join("",i,null,(function(e){t("log","H5加入通道成功"," at pages/live-info/android.nvue:346")}),null),n.on("stream-added",(function(t){n.subscribe(t.stream,null)})),n.on("stream-subscribed",(function(e){var i=e.stream,a=String(i.getId());t("log","订阅成功后播放主播的流streamId："+a," at pages/live-info/android.nvue:356");var n=document.getElementById("subremoteContainer");n.id=a,document.getElementById("remoteContainer").appendChild(n),i.play(a)})),n.on("stream-removed",(function(e){var i=e.stream;String(i.getId());i.close(),t("log","远端用户取消发布流时，关闭及移除对应的流。"," at pages/live-info/android.nvue:369")})),n.on("peer-leave",(function(e){var i=e.stream;String(i.getId());i.close(),t("log","远端用户离开频道时，关闭及移除对应的流。"," at pages/live-info/android.nvue:377")}))}),0)},enterLive:function(e,i){var a=this,n=u.globalData;a.agorauid=n.userinfo.id,uni.request({url:n.site_url+"Live.Enter",method:"GET",data:{liveuid:e,courseid:i,lessonid:"",token:n.userinfo.token,uid:n.userinfo.id},success:function(e){t("log",e," at pages/live-info/android.nvue:400"),a.agoraappid=e.data.data.info[0].sound_appid,a.agoramRoomName=e.data.data.info[0].stream,t("log","获取数据agoraappid："+a.agoraappid," at pages/live-info/android.nvue:403"),t("log","获取数据agoramRoomName："+a.agoramRoomName," at pages/live-info/android.nvue:404"),2==a.phonetype?(t("log","接口返回进入ios"," at pages/live-info/android.nvue:406"),setTimeout((function(){a.$nextTick((function(){a.$refs.videoIos.focus({appid:a.agoraappid,mRoomName:a.agoramRoomName,uid:n.userinfo.id})}))}),0)):1==a.phonetype?(t("log","接口返回进入android"," at pages/live-info/android.nvue:417"),setTimeout((function(){a.$nextTick((function(){a.$refs.videoAdnroid.clearTel(a.agoraappid+"声"+a.agoramRoomName+"网"+n.userinfo.id)}))}),0)):3==a.phonetype?(t("log","接口返回进入H5"," at pages/live-info/android.nvue:428"),a.agoraH5(a.agoraappid,a.agoramRoomName)):4==a.phonetype&&a.agoraWechat(a.agoraappid,a.agoramRoomName,n.userinfo.id)}})},inputing:function(t){},submit:function(t){var e=this;if(""===this.content)return uni.showToast({title:"消息不能为空",icon:"none"});var i=u.globalData.userinfo,a=!0===this.isQue?"1":"0",n={msg:[{_method_:"SendMsg",action:"0",token:i.token,uid:""+i.id,user_nickname:""+i.user_nickname,avatar:""+i.avatar,liveuid:""+this.liveInfo.liveuid,content:""+this.content,equipment:"uni-app",create_time:Math.floor((new Date).getTime().toString()/1e3),msgtype:a}],retcode:"000000",retmsg:"OK"};if(1==this.isConnectSocket){d.emit("broadcast",n),this.tabIndex=1;var o=u.globalData,s=this.liveInfo.liveuid,r=this.liveInfo.courseid,l=this.sort2url({uid:this.userInfo.id,liveuid:s,courseid:r,lessonid:"0",type:"0",content:this.content,url:"",user_type:this.userInfo.type});uni.request({url:o.site_url+"Live.SetChat",method:"GET",data:{uid:this.userInfo.id,token:this.userInfo.token,liveuid:s,courseid:r,lessonid:0,type:0,content:this.content,url:"",length:0,status:a,user_type:this.userInfo.type,sign:l},success:function(t){e.$refs.input1.blur()},fail:function(){uni.showToast({icon:"none",title:"网络错误"})}})}},question:function(t){0==this.isQue?this.isQue=!0:this.isQue=!1},sort2url:function(t){for(var e=Object.keys(t).sort(),i={},a=0;a<e.length;a++)i[e[a]]=t[e[a]];var n="";for(var o in i)n=n+o+"="+i[o]+"&";return n=n.substr(0,n.length-1),n+="&"+u.globalData.sign_key,s.default.hex_md5(n)},listscroll:function(e){t("log",e," at pages/live-info/android.nvue:552")},getHeight:function(t){var e=this,i=uni.createSelectorQuery().in(this);i.selectAll(t).boundingClientRect((function(t){e.scrollH=t[0].height})).exec()},prizeScroll:function(){}}};e.default=l}).call(this,i("0de9")["log"])},"9f88":function(t,e,i){"use strict";var a;i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return a}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"live-all-wrap"},[1==t.phonetype?[a("v-uni-view",{staticClass:"video-wrap"},[a("TestText",{ref:"videoAdnroid",staticClass:"video-wrap",attrs:{tel:"xxxxxx"}})],1)]:2==t.phonetype?[a("v-uni-view",{staticClass:"video-wrap"},[a("dc-TestComponent",{ref:"videoIos",staticClass:"video-wrap",attrs:{appid:"xxxxxx"}})],1)]:3==t.phonetype?[a("v-uni-view",{ref:"remotecontainer",attrs:{id:"remoteContainer"}},[a("v-uni-view",{staticClass:"video-wrap",attrs:{id:"subremoteContainer"}})],1)]:void 0,a("v-uni-view",{staticStyle:{width:"750rpx",height:"90rpx","flex-direction":"row","background-color":"#FFFFFF"}},t._l(t.tabBars,(function(e,i){return a("v-uni-view",{key:i,ref:"tab"+i,refInFor:!0,staticStyle:{height:"90rpx",width:"250rpx","align-items":"center"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.changeXXK(i)}}},[a("v-uni-text",{staticStyle:{"font-size":"30rpx",height:"90rpx",width:"100rpx","text-align":"center","line-height":"90rpx","border-bottom-width":"5rpx","border-style":"solid"},style:{color:t.tabIndex===i?"#3BDCA8":"#A9A5A0","border-color":t.tabIndex===i?"#3BDCA8":"#FFFFFF"}},[t._v(t._s(e.name))])],1)})),1),a("v-uni-view",{staticStyle:{width:"750rpx",height:"600rpx","background-color":"#F4F5F6"},attrs:{current:t.tabIndex},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.onChangeTab.apply(void 0,arguments)}}},[0==t.tabIndex?a("v-uni-view",{staticClass:"zhinan"},[a("v-uni-text",{staticClass:"zhinantext"},[t._v("听课指南")])],1):t._e(),0==t.tabIndex?a("v-uni-view",[a("list",{staticStyle:{width:"750rpx",height:"600rpx"}},t._l(t.list,(function(e,i){return a("cell",{key:i,staticClass:"chatcell"},[1==e.user_type?a("v-uni-view",{staticClass:"messagebottom",attrs:{id:"chat"+i}},[a("v-uni-image",{staticClass:"rounded",attrs:{src:e.avatar}}),a("v-uni-view",{staticClass:"message"},[a("v-uni-text",{staticClass:"user_nickname"},[t._v(t._s(e.user_nickname))]),a("v-uni-text",{staticClass:"textmessage"},[t._v(t._s(e.content))])],1)],1):t._e()],1)})),1)],1):t._e(),1==t.tabIndex?a("v-uni-view",[a("list",{staticClass:"chat1",staticStyle:{height:"600rpx"},attrs:{animation:t.animationData}},t._l(t.list,(function(e,i){return a("cell",{key:i,staticClass:"chatcell"},[e.uid===t.myID?[a("v-uni-view",{staticClass:"messagebottom2",attrs:{id:"chat"+i}},[a("v-uni-image",{staticClass:"rounded",attrs:{src:e.avatar}}),a("v-uni-view",{staticClass:"message"},[a("v-uni-text",{staticClass:"textmessage2"},[t._v(t._s(e.content))])],1),"1"==e.status?a("v-uni-text",{staticClass:"wen"},[t._v("问")]):t._e()],1)]:[a("v-uni-view",{staticClass:"messagebottom",attrs:{id:"chat"+i}},[a("v-uni-image",{staticClass:"rounded",attrs:{src:e.avatar}}),a("v-uni-view",{staticClass:"message"},[a("v-uni-text",{staticClass:"user_nickname"},[t._v(t._s(e.user_nickname))]),a("v-uni-text",{staticClass:"textmessage"},[t._v(t._s(e.content))])],1),"1"==e.status?a("v-uni-text",{staticClass:"wen2"},[t._v("问")]):t._e()],1)]],2)})),1)],1):t._e(),2==t.tabIndex?a("v-uni-view",[a("list",{staticStyle:{width:"750rpx",height:"600rpx"}},t._l(t.list,(function(e,i){return a("cell",{key:i,staticClass:"chatcell"},[e.uid===t.myID?["1"==e.status?a("v-uni-view",{staticClass:"messagebottom2",attrs:{id:"chat"+i}},[a("v-uni-image",{staticClass:"rounded",attrs:{src:e.avatar}}),a("v-uni-view",{staticClass:"message"},[a("v-uni-text",{staticClass:"textmessage2"},[t._v(t._s(e.content))])],1),a("v-uni-text",{staticClass:"wen"},[t._v("问")])],1):t._e()]:["1"==e.status?a("v-uni-view",{staticClass:"messagebottom",attrs:{id:"chat"+i}},[a("v-uni-image",{staticClass:"rounded",attrs:{src:e.avatar}}),a("v-uni-view",{staticClass:"message"},[a("v-uni-text",{staticClass:"user_nickname"},[t._v(t._s(e.user_nickname))]),a("v-uni-text",{staticClass:"textmessage"},[t._v(t._s(e.content))])],1),a("v-uni-text",{staticClass:"wen2"},[t._v("问")])],1):t._e()]],2)})),1)],1):t._e()],1),2!=t.tabIndex?[a("v-uni-view",{staticClass:"inputbottom"},[a("v-uni-view",{staticClass:"inputclass"},[a("v-uni-text",{staticClass:"send",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submit.apply(void 0,arguments)}}},[t._v("发送")]),a("v-uni-view",{staticClass:"inputborder"},[a("v-uni-input",{ref:"input1",staticClass:"input",attrs:{type:"text","confirm-type":"send",placeholder:"说点什么..."},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.inputing.apply(void 0,arguments)}},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),a("v-uni-view",{staticClass:"wen-btn-wrap"},[a("v-uni-view",{staticClass:"duihao-wrap",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.question.apply(void 0,arguments)}}},[1==t.isQue?a("v-uni-image",{staticClass:"duihao-img",attrs:{src:i("60a5"),mode:"aspectFill"}}):t._e(),0==t.isQue?a("v-uni-image",{staticClass:"duihao-img",attrs:{src:i("628c"),mode:"aspectFill"}}):t._e()],1),a("v-uni-text",{staticClass:"tiwen"},[t._v("提问")])],1)],1)],1)],1)]:t._e()],2)},o=[]},c887:function(t,e,i){var a=i("24fb");e=a(!1),e.push([t.i,".live-all-wrap[data-v-2e1b79a5]{background-color:#f4f5f6}.video-wrap[data-v-2e1b79a5]{width:%?750?%;height:%?400?%;background-color:#000}.rounded[data-v-2e1b79a5]{margin-top:%?20?%;width:%?80?%;height:%?80?%;-webkit-border-radius:%?40?%;border-radius:%?40?%}.messagebottom[data-v-2e1b79a5]{\n\t/* background-image: url(../../static/chat_message_other.png); */-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row}.messagebottom2[data-v-2e1b79a5]{\n\n\t/* background-image: url(../../static/chat_message_self.png); */-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-webkit-flex-direction:row-reverse;flex-direction:row-reverse}.message[data-v-2e1b79a5]{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column}.user_nickname[data-v-2e1b79a5]{margin-top:%?20?%;padding:%?10?%;font-size:%?30?%;font-weight:700}.scroll1[data-v-2e1b79a5]{width:%?750?%}.textmessage[data-v-2e1b79a5]{margin-top:%?20?%;padding:%?20?%;-webkit-border-radius:%?8?%;border-radius:%?8?%;font-size:%?30?%;font-weight:400;max-width:%?450?%;background-color:#fff;color:#000}.textmessage2[data-v-2e1b79a5]{margin-top:%?20?%;padding:%?20?%;-webkit-border-radius:%?8?%;border-radius:%?8?%;font-size:%?30?%;font-weight:400;max-width:%?450?%;background-color:#34d695;color:#fff}.inputbottom[data-v-2e1b79a5]{height:%?130?%;background-color:#fff;position:fixed;bottom:%?0?%;width:%?750?%}.inputclass[data-v-2e1b79a5]{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;height:%?130?%;width:%?750?%}.inputborder[data-v-2e1b79a5]{position:absolute;margin-top:%?20?%;bottom:unset;height:%?80?%;left:%?20?%;right:%?140?%;background-color:#f4f5f6;-webkit-border-radius:%?40?%;border-radius:%?40?%}.input[data-v-2e1b79a5]{position:absolute;bottom:unset;height:%?80?%;left:%?20?%;right:%?100?%;line-height:2em;color:#000;font-size:%?30?%;-webkit-border-radius:%?40?%;border-radius:%?40?%;padding-right:%?20?%;padding-top:%?10?%;padding-bottom:%?10?%}.send[data-v-2e1b79a5]{position:absolute;right:%?30?%;color:#34d695;font-size:%?35?%;margin-top:%?40?%}.tiwen[data-v-2e1b79a5]{font-size:%?25?%;position:absolute;right:%?5?%;margin-top:%?8?%}.wen-btn-wrap[data-v-2e1b79a5]{width:%?100?%;height:%?50?%;position:absolute;right:%?20?%;margin-top:%?15?%;line-height:%?70?%;-webkit-border-radius:0 %?50?% %?50?% 0;border-radius:0 %?50?% %?50?% 0\n\n\t/* background-color: #F5F5F5; */}.duihao-img[data-v-2e1b79a5]{width:%?30?%;height:%?30?%}.duihao-wrap[data-v-2e1b79a5]{position:absolute;width:%?40?%;height:%?40?%;margin-top:%?8?%}.wen[data-v-2e1b79a5]{top:%?20?%;margin-right:%?10?%;margin-top:%?20?%;background-color:#34d695;color:#fff;width:%?40?%;height:%?37?%;font-size:%?30?%;text-align:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.wen2[data-v-2e1b79a5]{top:%?60?%;margin-left:%?10?%;margin-top:%?60?%;background-color:#34d695;color:#fff;width:%?40?%;height:%?37?%;font-size:%?30?%;text-align:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.zhinan[data-v-2e1b79a5]{background-color:#fff;margin-top:%?20?%;margin-left:%?40?%;margin-right:%?40?%;height:%?80?%;-webkit-border-radius:%?10?%;border-radius:%?10?%}.zhinantext[data-v-2e1b79a5]{font-size:%?35?%;height:%?80?%;padding-left:%?20?%;padding-top:%?20?%}",""]),t.exports=e},d648:function(t,e,i){"use strict";i.r(e);var a=i("9f88"),n=i("4dbc");for(var o in n)"default"!==o&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("dbb5");var s,r=i("f0c5"),u=Object(r["a"])(n["default"],a["b"],a["c"],!1,null,"2e1b79a5",null,!1,a["a"],s);e["default"]=u.exports},dbb5:function(t,e,i){"use strict";var a=i("2db6"),n=i.n(a);n.a}}]);